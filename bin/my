#!/usr/bin/env bash
#########################################################################
# my - a bask extension script
#
# Add this script and bask to your $PATH. For usage information, run:
# my help
#########################################################################

source "$(which bask)"

desc ip <<EOM
Usage:
  $_ME ip [--local | --remote]

Options:
  --local   Display the local IP address.
  --remote  Display the remote IP address (default).

Description:
  Print the current IP address. By default, the remote IP address is queried
  and displayed, or the '--local' option can be used to return the local IP
  address.
EOM
ip() {
  # Only the '--local' option is actually checked. The '--remote' option is the
  # default behavior when no option is passed, but the option is included for
  # psychological balance. :-)
  if [[ "$1" == "--local" ]]; then
    local _active_interface
    _active_interface="$(
      ifconfig | \
        pcregrep \
          -M \
          -o '^[^\t:]+:([^\n]|\n\t)*status: active' | \
      egrep \
        -o \
        -m 1 \
        '^[^\t:]+'
    )"
    _debug printf "ip() \$_active_interface: %s\n" "$_active_interface"
    ipconfig getifaddr "$_active_interface"
  else
    dig +short myip.opendns.com @resolver1.opendns.com
  fi
}

_main
